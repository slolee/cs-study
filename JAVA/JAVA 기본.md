## JVM 이란 무엇인가요?

JVM 은 Java Virtual Machine 의 약자로 OS 위에서 동작하는 프로세스로써 Java 애플리케이션을 실행시켜주는 가상머신입니다. Java 애플리케이션을 OS 에서 직접 실행하는 것이 아니라 OS 위에서 실행중인 JVM 에 의해서 실행하기 때문에 Java 애플리케이션은 OS 에 맞는 JVM 만 동작한다면 운영체제와 상관없이 실행할 수 있다는 장점이 있습니다.

JVM 의 Java 애플리케이션을 실행해주는 것 외에도 메모리 관리, 가비지 컬렉터 등 Java 애플리케이션이 실행되는 동안 관리해주는 역할도 수행합니다.

<br>

## JVM 에 의해서 Java 애플리케이션이 실행된다고 했는데, 그 과정에 대해서 설명해주세요.

개발자가 작성한 자바 파일을 JAVAC 로 불리는 Java 컴파일러가 클래스 파일로 변환합니다. 이렇게 변환된 클래스 파일은 JVM 의 클래스 로더에 의해서 JVM 내부로 로드됩니다.

그리고 JVM 내부의 실행엔진에 의해서 해당 클래스 파일이 해석되어 `Runtime Data Area` 라고 불리는 메모리에 적재됩니다. 이러한 역할을 수행하는 것은 실행엔진에 포함되어있는 `인터프리터와 JIT` 가 있습니다. 인터프리터 방식은 코드를 명령어 단위로 해석하고 JIT 는 전체 코드를 해석해 메모리에 적재합니다. 인터프리터 방식은 특정 코드가 반복되어 실행될수록 성능이 안좋기 때문에 초기 어느정도만 인터프리터 방식을 사용하고 그 이후에는 JIT 방식을 사용해 전체를 해석해 메모리에 적재하는 것으로 알고 있습니다.

이제 `메모리에 적재된 이 Java 애플리케이션은 JVM 에 의해서 실행되며 가비지 컬렉터에 의해서 메모리 관리`를 받게 됩니다.

<br>

## 클래스 파일을 JVM 으로 로드하는 역할을하는 것이 클래스 로더라고 했는데 이 역할 외에는 어떤 역할을 수행할까요?

`클래스 로더는 클래스 파일을 JVM 에 로드하는 역할 외에도 사용하지 않는 클래스를 메모리에서 삭제하거나 Java 애플리케이션 실행중에 필요한 클래스파일을 동적으로 로드하는 역할을 수행하는 것으로 알고 있습니다.`

<br>

## Runtime Data Area 가 어떻게 이루어져 있는지 설명해주실수 있나요?

Runtime Data Area 는 일반적인 메모리 구조와 동일하게 지역변수나 함수의 반환주소를 저장하기 위한 스택, 그리고 동적할당된 객체를 저장하기 위한 힙이 있는 것으로 알고 있습니다. 이외에도 `클래스에 대한 정보를 저장하기 위한 메소드 영역과 네이티브 메소드 영역`이 있고, PC Register 과 연산에 필요한 다양한 레지스터들이 존재합니다.

<br>

## 가비지 컬렉터에 대해서 설명해주실수 있나요?

가비지 컬렉터는 힙 메모리 영역에서 더 이상 참조되지 않는 객체를 메모리에서 해제해주는 역할을 수행하며, JVM 의 실행엔진에 포함되어 있는 것으로 알고 있습니다. C언어에서는 힙 메모리에 있는 메모리를 해제해주기 위해서는 개발자가 직접 free 를 해줘야 했지만 가비지 컬렉터가 이러한 역할을 수행해줍니다.

<br>

## 가비지 컬렉터의 내부 동작과정에 대해서 설명해주실수 있나요?

가비지 컬렉터는 내부적으로 크게 두 가지 영역인 Young 영역과 Old 영역으로 나뉘는 것으로 알고 있습니다.

Young 영역에서 동작하는 가비지 컬릭터는 Minor GC 이고, 해당 Young 영역은 내부적으로 에덴 영역과 서바이벌 영역으로 한번 더 나뉘게 됩니다. 에덴 영역에는 힙 영역에 메모리가 처음 할당된 객체가 들어가고 에덴 영역이 꽉차게 되면 Minor GC 가 동작하며 참조되지 않은 메모리를 해제 하게 됩니다. Minor GC 를 한 번 견딘 객체는 에덴 영역에서 서바이벌 영역으로 넘어가며, 일정 횟수가 지난 후 서바이벌 영역에 있는 객체는 Old 영역으로 이동하게 됩니다.

Old 영역에서 동작하는 가비지 컬렉터는 Major GC 입니다. Young 영역에서 오랫동안 살아남은 객체가 해당 영역으로 옮겨지게 되는데 해당 Old 영역이 꽉차게되면 Major GC 가 동작하게 됩니다. Major GC 가 동작하는데 걸리는 시간은 Minor GC 가 동작하는데 걸리는 시간보다 훨씬 많다고 알고 있습니다. 따라서 Major GC 가 너무 자주 동작하게되면 시스템 성능에 영향이 있을 수 있다고 생각합니다.

가비지 컬렉터가 동작할 때는 크게 두 가지 동작과정을 거치게 됩니다.

먼저 Stop the World 를 통해서 가비지 컬렉터가 동작하기 위한 스레드를 제외한 모든 스레드를 정지시킵니다. 이 작업이 시스템 성능에 가장 큰 영향을 미치는 것으로 알고 있고 튜닝시에 이 시간을 줄이는 것도 하나의 중요한 목표라고 알고 있습니다.

그리고나서 `Mark and Sweep 을 수행`합니다. 여기서 `마크는 힙 영역에서 더 이상 참조되지 않는 객체를 찾는 과정`을 의미합니다. 더 이상 참조되지 않는다는 것은 메소드 영역의 스태틱 필드, 네이티브 스택 메모리에서의 참조, JVM 스택 메모리에서 참조가 없다는 것을 의미합니다. 그리고 `스윕은 이렇게 탐색한 참조되지 않는 객체를 힙 메모리에서 할당 해제하는 과정`을 의미합니다.